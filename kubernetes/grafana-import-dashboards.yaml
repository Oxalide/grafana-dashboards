apiVersion: batch/v1
kind: Job
metadata:
  name: grafana-import-dashboard
  namespace: monitoring
spec:
  template:
    metadata:
      name: grafana-import-dashboard
    spec:
      containers:
      - name: grafana-import-dashboard
        image: oxalide/grafana-dashboards:latest
        imagePullPolicy: Always
        env:
        - name: GRAFANA_USERNAME
          valueFrom:
            secretKeyRef:
              name: grafana-secrets
              key: admin-user
        - name: GRAFANA_PASSWORD
          valueFrom:
            secretKeyRef:
              name: grafana-secrets
              key: admin-password
        command:
        - python
        - bot.py
        - --conf
        - grafana-dashboards/dashboards
        - --grafana-url
        - http://grafana-k8s
        - --prometheus-endpoint
        - http://prometheus-operated:9090
      restartPolicy: Never
